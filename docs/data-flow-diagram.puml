@startuml "MiraVeja - Data Flow Diagram"
!theme plain
!define RECTANGLE class

title MiraVeja - Data Flow Diagram

actor User as user #lightblue

package "Frontend Layer" {
    component [Vue.js SPA\nw/ Vuetify] as frontend #palegreen
}

package "API Layer" {
    component [Flask REST API] as api #lightcyan
}

package "Business Logic" {
    component [Image Downloader] as downloader #lightyellow
    component [Embedding Generator\n(CLIP Model)] as embeddings #lightpink
    component [Search Engine] as search #lightcoral
}

package "Data Layer" {
    database "PostgreSQL\n(Metadata + Embeddings)" as db #wheat
    folder "Filesystem\n(Image Storage)" as fs #lightgray
}

' User interactions
user --> frontend : Browse & Search
frontend <--> api : HTTP/JSON

' API orchestration
api --> downloader : Trigger downloads
api --> search : Search requests
api <-- search : Results

' Business logic flows
downloader --> db : Store metadata
downloader --> fs : Save images
downloader --> embeddings : Generate embeddings
embeddings --> db : Store vectors

' Search flows
search --> db : Query metadata/embeddings
search --> fs : Retrieve images
search <-- embeddings : Encode search queries

@enduml