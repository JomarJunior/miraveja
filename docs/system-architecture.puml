@startuml "MiraVeja - System Architecture"
!theme plain

title MiraVeja - System Architecture

package "Frontend" as frontend_pkg #e1f5fe {
    component [Vue.js SPA] as vue #4fc3f7
    component [Vuetify UI] as vuetify #29b6f6
    vue --> vuetify : Uses components
}

package "Backend Services" as backend_pkg #f3e5f5 {
    component [Flask API] as api #9c27b0
    component [Dependency Injection] as di #7b1fa2
    component [Event System] as events #6a1b9a
    
    api ..> di : Uses
    api ..> events : Publishes/Subscribes
}

package "Core Services" as core_pkg #fff3e0 {
    component [Image Downloader] as downloader #ff9800
    component [Metadata Parser] as parser #f57c00
    component [Scheduler] as scheduler #ef6c00
    component [CLIP Embeddings] as clip #e65100
    
    downloader <--> parser : Processes metadata
    scheduler --> downloader : Triggers downloads
    downloader --> clip : Generates embeddings
}

package "Data Layer" as data_pkg #e8f5e8 {
    database "PostgreSQL" as db {
        component [Metadata] as metadata
        component [Embeddings] as embeddings_db
        metadata --|> embeddings_db
    }
    folder "File System" as fs {
        component [Images] as images
        component [Thumbnails] as thumbs
        images --|> thumbs
    }
}

package "Search & Retrieval" as search_pkg #ffebee {
    component [Semantic Search] as search #f44336
    component [Content Retrieval] as retrieval #d32f2f
    
    search <--> retrieval : Coordinates results
}

' Main flow connections
vue <--> api : HTTP/REST
api --> downloader : Orchestrates
api --> search : Queries

' Data connections
downloader --> db : Stores metadata
downloader --> fs : Saves images
clip --> db : Stores vectors

search --> db : Queries embeddings
retrieval --> fs : Fetches content
search --> retrieval : Image references

@enduml